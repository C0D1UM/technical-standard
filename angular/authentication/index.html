<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Authentication Guidelines | CODIUM Technical Standard</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Authentication Guidelines" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="CODIUM Co., Ltd." />
<meta property="og:description" content="CODIUM Co., Ltd." />
<link rel="canonical" href="https://codium.co/technical-standard/angular/authentication/" />
<meta property="og:url" content="https://codium.co/technical-standard/angular/authentication/" />
<meta property="og:site_name" content="CODIUM Technical Standard" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Authentication Guidelines" />
<script type="application/ld+json">
{"description":"CODIUM Co., Ltd.","url":"https://codium.co/technical-standard/angular/authentication/","@type":"WebPage","headline":"Authentication Guidelines","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/technical-standard/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://codium.co/technical-standard/feed.xml" title="CODIUM Technical Standard" /></head>
<body><header class="site-header">
    <div class="wrapper"><a class="site-title" rel="author" href="/technical-standard/">CODIUM Technical Standard</a><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
                <span class="menu-icon">
                    <svg viewBox="0 0 18 15" width="18px" height="15px">
                        <path
                            d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
                    </svg>
                </span>
            </label>

            <div class="trigger">
                <form action="/technical-standard/search.html" method="get">
    <label for="search-box">Search</label>
    <input type="text" id="search-box" name="query">
    <input type="submit" value="search">
</form>

            </div>
        </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h3><strong>Table of Contents</strong></h3>
<ul><li><a href="#refresh-token">Refresh Token</a><ul><li><a href="#main-component">Main Component</a></li><li><a href="#optional-short-expiration-time">(Optional) Short Expiration Time</a></li></ul></li><li><a href="#localstorage-vs-sessionstorage">LocalStorage VS SessionStorage</a></li><li><a href="#localstorage-vs-cookie">LocalStorage VS Cookie</a></li></ul>

          <hr><br><br>
        

        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Authentication Guidelines</h1>
  </header>

  <div class="post-content">
    <h2 id="refresh-token">Refresh Token</h2>
<h3 id="main-component">Main Component</h3>
<p>By default, backend will set default token expiration time = 1 month. So, on frontend, the easiest way is just refreshing token every time when user refresh website. You can do by adding code below in your <code>main.component.ts</code></p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">MainComponent</span> <span class="k">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
    <span class="nx">ngOnInit</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// call refresh token API</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">authService</span><span class="p">.</span><span class="nx">refreshToken</span><span class="p">({</span><span class="na">refresh</span><span class="p">:</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">refresh</span><span class="p">}).</span><span class="nx">subscribe</span><span class="p">(</span>
            <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">Token</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="c1">// save token and user information to local storage.</span>
                <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">currentUser</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="c1">// if error occurs, you may use old token and do nothing.</span>
                <span class="k">return</span><span class="p">;</span>

                <span class="c1">// or redirect to login page.</span>
                <span class="c1">// this.router.navigate(['/login']);</span>
            <span class="p">}</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h3 id="optional-short-expiration-time">(Optional) Short Expiration Time</h3>
<p>If token time is very short (Ex. Banking website which token is expired in 5 minutes), you must check token expiration time before calling request and refresh token if needed. See code below.</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">refreshTokenIfExpired</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// decode jwt token. This is very technical, you can skip this part if you don't understand.</span>
    <span class="kd">let</span> <span class="nx">base64Url</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">currentUser</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">.</span><span class="dl">'</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
    <span class="kd">let</span> <span class="nx">base64</span> <span class="o">=</span> <span class="nx">base64Url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-/g</span><span class="p">,</span> <span class="dl">'</span><span class="s1">+</span><span class="dl">'</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/_/g</span><span class="p">,</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">jsonPayload</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">base64</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="dl">''</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="dl">'</span><span class="s1">%</span><span class="dl">'</span> <span class="o">+</span> <span class="p">(</span><span class="dl">'</span><span class="s1">00</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">c</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)).</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="dl">''</span><span class="p">));</span>

    <span class="kd">let</span> <span class="nx">decoded</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">jsonPayload</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">().</span><span class="nx">valueOf</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="kd">let</span> <span class="nx">refreshToken</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="c1">// check if token will be expired in 5 minutes (300000 = 5 minutes)</span>
    <span class="kd">let</span> <span class="nx">FIVE_MINUTES</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">decoded</span><span class="p">.</span><span class="nx">exp</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nx">decoded</span><span class="p">.</span><span class="nx">exp</span> <span class="o">&lt;</span> <span class="nx">now</span> <span class="o">-</span> <span class="nx">FIVE_MINUTES</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">refreshToken</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">decoded</span><span class="p">.</span><span class="nx">nbf</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nx">decoded</span><span class="p">.</span><span class="nx">nbf</span> <span class="o">&gt;</span> <span class="nx">now</span> <span class="o">-</span> <span class="nx">FIVE_MINUTES</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">refreshToken</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>

    <span class="c1">// call refresh token if it is nearly expired.</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">refreshToken</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">authService</span><span class="p">.</span><span class="nx">refreshToken</span><span class="p">(</span> <span class="p">...</span> <span class="p">)</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>
<h1 id="authentication-token-interceptor">Authentication Token Interceptor</h1>
<p>Authentication token interceptor will add token to request.</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">Injectable</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">HttpEvent</span><span class="p">,</span> <span class="nx">HttpHandler</span><span class="p">,</span> <span class="nx">HttpInterceptor</span><span class="p">,</span> <span class="nx">HttpRequest</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/common/http</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">Observable</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span><span class="nx">environment</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../environments/environment</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">JwtInterceptor</span> <span class="k">implements</span> <span class="nx">HttpInterceptor</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">authenticationService</span><span class="p">:</span> <span class="nx">AuthenticationService</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">}</span>

  <span class="nx">intercept</span><span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">HttpRequest</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">next</span><span class="p">:</span> <span class="nx">HttpHandler</span><span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">HttpEvent</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="c1">// handle request that don't want to add authentication header.</span>
    <span class="c1">// Sample Code: `this.http.get('https://somewebsite/', {headers:{skip:"true"})`</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">skip</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
       <span class="k">return</span> <span class="nx">next</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// add auth header with jwt if user is logged in and request is to the api url</span>
    <span class="kd">const</span> <span class="nx">currentUser</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">currentUser</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">isApiUrl</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">environment</span><span class="p">.</span><span class="nx">baseUrl</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">currentUser</span> <span class="o">&amp;&amp;</span> <span class="nx">isApiUrl</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">request</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">clone</span><span class="p">({</span>
        <span class="na">setHeaders</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">Authorization</span><span class="p">:</span> <span class="s2">`Bearer </span><span class="p">${</span><span class="nx">currentUser</span><span class="p">}</span><span class="s2">`</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">next</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h1 id="localstorage">LocalStorage</h1>
<p>LocalStorage size is limited to about 5MB. Make sure that you don't save large files (Ex. profile pictures). You should download file from backend server instead.</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="nx">Bad</span><span class="p">.</span> <span class="nx">Do</span> <span class="nx">not</span> <span class="nx">save</span> <span class="nx">files</span> <span class="nx">data</span> <span class="nx">into</span> <span class="nx">localstorage</span><span class="p">.</span> <span class="nx">Size</span> <span class="nx">limit</span> <span class="k">is</span> <span class="nx">about</span> <span class="mi">5</span> <span class="nx">MB</span><span class="p">.</span>
<span class="kd">let</span> <span class="nx">bytes</span> <span class="o">=</span> <span class="p">....</span> 
<span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">file</span><span class="dl">'</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">)</span>
</code></pre></div></div>
<h2 id="localstorage-vs-sessionstorage">LocalStorage VS SessionStorage</h2>
<p>You should not save user profile into SessionStorage. Different between LocalStorage and SessionStorage is below.</p>
<ul>
<li>LocalStorage will save data and share that data when user open second tabs.</li>
<li>SessionStorage will not share data when across tabs.</li>
<li>SessionStorage will automatically deleted when user close tab, but does not delete when user refresh website.</li>
</ul>
<p>Here is what happen if you use SessionStorage to save user token/profiles.</p>
<ul>
<li>If user open second tabs of the same website and user profile changes, it will not change on the first tab.</li>
<li>If user logout from the first tabs, second tab is still logged in.</li>
<li>User have to login again when close tab and open a new one.</li>
</ul>
<h2 id="localstorage-vs-cookie">LocalStorage VS Cookie</h2>
<p>You should not save user profile and authentication token into cookies because it can be hacked by 'CSRF' method. More info on this <a href="https://hydrasky.com/network-security/cross-site-request-forgery-csrf/">link</a></p>
<h1 id="prevent-authentication-hacking">Prevent Authentication Hacking</h1>
<ul>
<li>Use https all the time.</li>
<li>You should use LocalStorage to save user profile/authentication token (not cookie. see topic above)</li>
<li>When user refresh website, frontend should refresh user profile (see topic &quot;Refresh Token&quot; above).</li>
<li>You should not send password or sensitive information in GET method. Even though GET param is encrypted in https but it may be logged in Nginx or Django.</li>
</ul>

  </div>

</article>


        

        
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/technical-standard/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">CODIUM Technical Standard</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">CODIUM Technical Standard</li><li><a class="u-email" href="mailto:contact@codium.co">contact@codium.co</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/c0d1um"><svg class="svg-icon"><use xlink:href="/technical-standard/assets/minima-social-icons.svg#github"></use></svg> <span class="username">c0d1um</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>CODIUM Co., Ltd.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
