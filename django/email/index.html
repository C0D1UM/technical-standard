<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Sending Email | CODIUM Technical Standard</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Sending Email" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="CODIUM Co., Ltd." />
<meta property="og:description" content="CODIUM Co., Ltd." />
<link rel="canonical" href="https://codium.co/technical-standard/django/email/" />
<meta property="og:url" content="https://codium.co/technical-standard/django/email/" />
<meta property="og:site_name" content="CODIUM Technical Standard" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Sending Email" />
<script type="application/ld+json">
{"description":"CODIUM Co., Ltd.","url":"https://codium.co/technical-standard/django/email/","@type":"WebPage","headline":"Sending Email","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/technical-standard/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://codium.co/technical-standard/feed.xml" title="CODIUM Technical Standard" /></head>
<body><header class="site-header">
    <div class="wrapper"><a class="site-title" rel="author" href="/technical-standard/">CODIUM Technical Standard</a><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
                <span class="menu-icon">
                    <svg viewBox="0 0 18 15" width="18px" height="15px">
                        <path
                            d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
                    </svg>
                </span>
            </label>

            <div class="trigger">
                <form action="/technical-standard/search.html" method="get">
    <label for="search-box">Search</label>
    <input type="text" id="search-box" name="query">
    <input type="submit" value="search">
</form>

            </div>
        </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h3><strong>Table of Contents</strong></h3>
<ul><li><a href="#use-django-build-in-email-backend">Use Django Build-in Email Backend</a></li><li><a href="#email-body-best-practices">Email Body Best Practices</a></li><li><a href="#prevent-actually-send-email-to-customer">Prevent Actually Send Email to Customer</a><ul><li><a href="#domain-name-filtering">Domain Name Filtering</a></li><li><a href="#log-email-to-console">Log Email to Console</a></li><li><a href="#mailhog">MailHog</a></li></ul></li><li><a href="#using-sendgrid">Using SendGrid</a><ul><li><a href="#rest-api-vs-smtp">REST API vs SMTP</a></li><li><a href="#dedicate-ip-address">Dedicate IP Address</a></li></ul></li></ul>

          <hr><br><br>
        

        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Sending Email</h1>
  </header>

  <div class="post-content">
    <p>Best practices when working on sending email feature.</p>
<h2 id="use-django-build-in-email-backend">Use Django Build-in Email Backend</h2>
<p>Read more <a href="https://docs.djangoproject.com/en/3.1/topics/email/">https://docs.djangoproject.com/en/3.1/topics/email/</a>.</p>
<h2 id="email-body-best-practices">Email Body Best Practices</h2>
<p>Some email client like GMail scan the email body before notify user so here some
best practices preventing email not received by customer immediately.</p>
<ul>
<li>Use plain-text email if possible</li>
<li>When include url always display it to user, do not hide it. Client like GMail
will scan to see if the given url is redirect to page as it says.</li>
<li>Allow user to unsubscribe the newsletter, by adding a url redirect to a form
that unsubscribe user from newsletter.</li>
</ul>
<h2 id="prevent-actually-send-email-to-customer">Prevent Actually Send Email to Customer</h2>
<p>There might be time that you would like to debug or fix email sending bug, and
you dump data from the production to reproduce. There are high chances that you
accidentally send email to actual customer since you are using production
database. Below are some best practices handling this problem:</p>
<h3 id="domain-name-filtering">Domain Name Filtering</h3>
<p>In Django settings file, you should have a setting that only allow email to send
to specific email address.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># settings.py
</span><span class="n">ALLOW_EMAIL_DOMAINS</span> <span class="o">=</span> <span class="n">env</span><span class="p">.</span><span class="nb">list</span><span class="p">(</span><span class="s">'ALLOW_EMAIL_DOMAINS'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">'codium.co'</span><span class="p">])</span>

<span class="c1"># send_email.py
</span><span class="n">receivers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'a@codium.co'</span><span class="p">,</span>
    <span class="s">'b@gmail.com'</span><span class="p">,</span>
    <span class="s">'c@sale.com'</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">allowed_receivers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># Do the filtering
# After filtered, allowed_receivers should has only ['a@codium.co']
</span>
<span class="kn">from</span> <span class="nn">django.core.mail</span> <span class="kn">import</span> <span class="n">send_mail</span>
<span class="n">send_mail</span><span class="p">(</span>
    <span class="s">'Subject'</span><span class="p">,</span>
    <span class="s">'Message'</span><span class="p">,</span>
    <span class="n">allowed_receivers</span><span class="p">,</span>
    <span class="n">fail_silently</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>
</code></pre></div></div>
<p>So before sending email, you can filter for only domain name in allowed list.</p>
<p><strong>Note:</strong> SendGrid is not allow duplicated receiver addresses.</p>
<h3 id="log-email-to-console">Log Email to Console</h3>
<p>The second solution is when running local environment you can use Django console
email backend. When define this in <code>settings.py</code> it will only log email to
console instead of actually connecting to SMTP server and send email.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># settings.py
</span><span class="n">EMAIL_BACKEND</span> <span class="o">=</span> <span class="n">env</span><span class="p">(</span>
    <span class="n">var</span><span class="o">=</span><span class="s">'DJANGO_EMAIL_BACKEND'</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="s">'django.core.mail.backends.console.EmailBackend'</span>
<span class="p">)</span>
</code></pre></div></div>
<h3 id="mailhog">MailHog</h3>
<p>Using MailHog allowed you to actually send email via SMTP without delivering
to the client email server. It also provided a simple web interface, so we able
to check the sent email. Here the simplest setup using <code>docker-compose</code>:</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3'</span>
<span class="na">services</span><span class="pi">:</span>
    <span class="na">mail</span><span class="pi">:</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">mailhog/mailhog</span>
        <span class="na">port</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">1025:1025</span> <span class="c1"># SMTP Server</span>
            <span class="pi">-</span> <span class="s">1080:1080</span> <span class="c1"># Web UI</span>
</code></pre></div></div>
<p><strong>Note:</strong> MailHog purposes is only for testing small amount of emails, when
sent large amount of email to MailHog, it will show some performance issue like
mail is missing or slow loading.</p>
<h2 id="using-sendgrid">Using SendGrid</h2>
<h3 id="rest-api-vs-smtp">REST API vs SMTP</h3>
<p>From experiences, SendGrid email is more stable when using API, so I would
recommend using SendGrid API instead of SMTP.</p>
<h3 id="dedicate-ip-address">Dedicate IP Address</h3>
<p>Use dedicate ip feature when ever possible (this is a pay feature). By using a
dedicated IP, allow us to not use the shared IP from SendGrid. Since the
shared IP address is free, people try to use it for bad purposes and this
cause those shared IP to be banned from some email server like HotMail, Gmail,
etc., so if you wonder why email is not received by the customer,
this could be the reason.</p>

  </div>

</article>


        

        
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/technical-standard/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">CODIUM Technical Standard</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">CODIUM Technical Standard</li><li><a class="u-email" href="mailto:contact@codium.co">contact@codium.co</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/c0d1um"><svg class="svg-icon"><use xlink:href="/technical-standard/assets/minima-social-icons.svg#github"></use></svg> <span class="username">c0d1um</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>CODIUM Co., Ltd.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
