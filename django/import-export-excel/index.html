<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Recommended Library | CODIUM Technical Standard</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Recommended Library" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="CODIUM Co., Ltd." />
<meta property="og:description" content="CODIUM Co., Ltd." />
<link rel="canonical" href="https://codium.co/technical-standard/django/import-export-excel/" />
<meta property="og:url" content="https://codium.co/technical-standard/django/import-export-excel/" />
<meta property="og:site_name" content="CODIUM Technical Standard" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Recommended Library" />
<script type="application/ld+json">
{"description":"CODIUM Co., Ltd.","url":"https://codium.co/technical-standard/django/import-export-excel/","@type":"WebPage","headline":"Recommended Library","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/technical-standard/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://codium.co/technical-standard/feed.xml" title="CODIUM Technical Standard" /></head>
<body><header class="site-header">
    <div class="wrapper"><a class="site-title" rel="author" href="/technical-standard/">CODIUM Technical Standard</a><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
                <span class="menu-icon">
                    <svg viewBox="0 0 18 15" width="18px" height="15px">
                        <path
                            d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
                    </svg>
                </span>
            </label>

            <div class="trigger">
                <form action="/technical-standard/search.html" method="get">
    <label for="search-box">Search</label>
    <input type="text" id="search-box" name="query">
    <input type="submit" value="search">
</form>

            </div>
        </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h3><strong>Table of Contents</strong></h3>
<ul><li><a href="#data-validation">Data Validation</a></li><li><a href="#simple-technique">Simple Technique</a><ul><li><a href="#when-to-use-this-technique">When to use this technique?</a></li><li><a href="#how">How?</a></li><li><a href="#architecture">Architecture</a></li></ul></li><li><a href="#advance-technique">Advance Technique</a><ul><li><a href="#when-to-use-this-technique-1">When to use this technique?</a></li><li><a href="#how-1">How?</a></li><li><a href="#architecture-1">Architecture</a><ul><li><a href="#minimum">Minimum</a></li><li><a href="#recommended">Recommended</a></li></ul></li></ul></li><li><a href="#simple">Simple</a><ul><li><a href="#when-to-use-this-technique-2">When to use this technique?</a></li><li><a href="#how-2">How?</a></li><li><a href="#architecture-2">Architecture</a></li></ul></li><li><a href="#advance">Advance</a><ul><li><a href="#when-to-use-this-technique-3">When to use this technique?</a></li><li><a href="#how-3">How?</a></li><li><a href="#architecture-3">Architecture</a><ul><li><a href="#minimum-1">Minimum</a></li><li><a href="#recommended-1">Recommended</a></li></ul></li></ul></li></ul>

          <hr><br><br>
        

        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Recommended Library</h1>
  </header>

  <div class="post-content">
    <p>These are the libraries that is recommended to use when working with Excel.</p>
<ul>
<li><a href="https://openpyxl.readthedocs.io/en/stable/">OpenPyXL</a> this library allow us to
easily handling excel.</li>
<li><a href="https://github.com/kz26/PyExcelerate">PyExcelerate</a> this library is used when
you need only speed meaning there is only data in the excel file, but if you need
personalization like color space it's not recommended.</li>
<li><a href="https://github.com/NorakGithub/django-excel-tools">Django Excel Tools</a> this library
is used to validate data from excel.</li>
</ul>
<h1 id="import-data-from-excel">Import Data From Excel</h1>
<p>Here are some best practices when working with importing data from excel.</p>
<h2 id="data-validation">Data Validation</h2>
<p>It is important to import correct data to our system, and we're not able to
trust if user only fill the correct data. So before importing data to the system,
each row and column must be validated. Doing this manually would take
too much time, so I would recommend using <a href="https://github.com/NorakGithub/django-excel-tools">Django Excel Tools</a> for data validation.</p>
<h2 id="simple-technique">Simple Technique</h2>
<h3 id="when-to-use-this-technique">When to use this technique?</h3>
<p>The data importing will never be more than 2000 rows. (Tip validation and raise
400 when data is more than 2000 rows)</p>
<h3 id="how">How?</h3>
<p>This would required a minimal setup, here the guides:</p>
<ul>
<li>User upload the excel.</li>
<li>API received excel, and validate data inside excel.</li>
<li>Import data to the system.</li>
<li>When import data to the database try to import in chunks, says you have 2000
rows of data you split it into 500 rows each to import to the database.</li>
<li>Return import status back to user.</li>
</ul>
<p>Overall process should not take any longer than 30 seconds.</p>
<h3 id="architecture">Architecture</h3>
<p><img src="/technical-standard/django/import-export-excel/img/simple-architecture.jpeg" alt="Simple Architecture" /></p>
<h2 id="advance-technique">Advance Technique</h2>
<h3 id="when-to-use-this-technique-1">When to use this technique?</h3>
<p>You don't know how many rows will be imported to the system at a time.</p>
<h3 id="how-1">How?</h3>
<p>This would required more setup because we will need background workers (Celery),
here are some guides:</p>
<ul>
<li>User upload the excel.</li>
<li>API received excel, and validate data inside excel.</li>
<li>After data validated, send file to background worker, then return status 203 as
the task has been accepted.</li>
<li>When importing to database try to split into chunks, says you have 100,000 of
rows, you should split into 5,000 each time importing to the database.</li>
<li>(Optional) Use more than one worker, so that you can import data in parallels.</li>
<li>Use COPY instead of INSERT. There are limitation when using COPY, but COPY is
way more faster than INSERT. Read more about COPY <a href="https://www.postgresql.org/docs/9.2/sql-copy.html">here</a>.</li>
</ul>
<h3 id="architecture-1">Architecture</h3>
<h4 id="minimum">Minimum</h4>
<p><img src="/technical-standard/django/import-export-excel/img/advance-minimum-architecture.png" alt="Advance Architecture" /></p>
<h4 id="recommended">Recommended</h4>
<p>It's recommended to separate between worker and API server because usually workers
will use a lot of resources, so if workers down it wouldn't affect API Server.</p>
<p><img src="/technical-standard/django/import-export-excel/img/advance-recommended-architecture.png" alt="Advance Architecture" /></p>
<h1 id="export-data-to-excel">Export Data to Excel</h1>
<p>Here are some best practices when working with exporting data from database to
excel.</p>
<h2 id="simple">Simple</h2>
<h3 id="when-to-use-this-technique-2">When to use this technique?</h3>
<p>If the data to export is no more than 2000 rows.</p>
<h3 id="how-2">How?</h3>
<p>This would required a minimal setup, here the guides:</p>
<ul>
<li>User request excel report via API.</li>
<li>API Server received request then query the database.</li>
<li>Return excel report via api.</li>
</ul>
<h3 id="architecture-2">Architecture</h3>
<p><img src="/technical-standard/django/import-export-excel/img/simple-architecture.jpeg" alt="Simple Architecture" /></p>
<h2 id="advance">Advance</h2>
<h3 id="when-to-use-this-technique-3">When to use this technique?</h3>
<p>If you have no idea how many rows it's gonna be or it will be more than 2000 rows.</p>
<h3 id="how-3">How?</h3>
<p>This would required more setup because we will need background workers (Celery),
here are some guides:</p>
<ul>
<li>User request excel file via API.</li>
<li>API server received the request, then send this job to background worker,
finally response 203 status code meaning the job is successfully accepted.</li>
<li>In worker, when query data from database it's recommend to split it chunks.
Says 2000 rows per query, you can use SQL <code>LIMIT</code> and <code>OFFSET</code> (using <a href="https://docs.djangoproject.com/en/3.1/topics/db/queries/#limiting-querysets">Django</a>) to achieve this.
This prevent database from crashing when requesting too much data at once.</li>
<li>(Optional) Use more than one worker, so we can export data in parallels.</li>
</ul>
<p><em>Note: Using <code>OFFSET</code> might cause performance problem later on, but this method
providing easier to implement. If that the case, you can sort the data and use
<code>WHERE</code> instead (you can also achieve this with Django).</em></p>
<p>Example:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">tbl_name</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">id</span>
<span class="k">where</span> <span class="n">id</span> <span class="o">&lt;</span> <span class="mi">2000</span>
<span class="k">limit</span> <span class="mi">2000</span>
</code></pre></div></div>
<h3 id="architecture-3">Architecture</h3>
<h4 id="minimum-1">Minimum</h4>
<p><img src="/technical-standard/django/import-export-excel/img/advance-minimum-architecture.png" alt="Advance Architecture" /></p>
<h4 id="recommended-1">Recommended</h4>
<p>It's recommended to separate between worker and API server because usually workers
will use a lot of resources, so if workers down it wouldn't affect API Server.</p>
<p><img src="/technical-standard/django/import-export-excel/img/advance-recommended-architecture.png" alt="Advance Architecture" /></p>
<h1 id="progress">Progress</h1>
<p>For a better UX, we should displaying the progress of import/export data to user.
There are multiple ways of doing this:</p>
<ul>
<li>Provide an API Endpoint for frontend to call every, says 5 seconds, and frontend display progress to user.
API response payload should contain progress value. This is easy to implement, but kinda
bad for the performance and resource usage.</li>
<li>Using Web Socket that wait for push event from backend. This is not easy to implement, but better in term
of performance and resource usage.</li>
</ul>

  </div>

</article>


        

        
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/technical-standard/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">CODIUM Technical Standard</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">CODIUM Technical Standard</li><li><a class="u-email" href="mailto:contact@codium.co">contact@codium.co</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/c0d1um"><svg class="svg-icon"><use xlink:href="/technical-standard/assets/minima-social-icons.svg#github"></use></svg> <span class="username">c0d1um</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>CODIUM Co., Ltd.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
